# FunBox
### 지도 기반 아이스브레이킹 소셜 플랫폼

> "아이스브레이킹 앱으로 우리동네에서 친구 만들기!"

<img src="https://github.com/boostcampwm2023/and05-funbox/assets/11827454/2f6c6652-87ea-445f-b730-197689e9d98c" width="200">
<img src="https://github.com/boostcampwm2023/and05-funbox/assets/11827454/a005eeae-9acf-4cb4-9bd6-2d083de7e47b" width="200">
<img src="https://github.com/boostcampwm2023/and05-funbox/assets/11827454/5039c0d0-c930-45bc-af99-25ad69b8fb96" width="200">

* 지도에서 새로운 친구를 찾아요!
* 친구를 찾으면 오프라인으로 만나러 가요
* 만나서 미니게임으로 아이스브레이킹을 해요

## 📒 주요 기능

### 네이버 소셜 로그인과 프로필 사진
* 네이버 계정으로 간편하게 로그인해요
* 나만의 프로필 사진을 보여줄 수 있어요
<img src="https://github.com/boostcampwm2023/and05-funbox/assets/11827454/9c8f29f4-b453-41a1-b95a-d2bd4e12cf7c" width="200">
<img src="https://github.com/boostcampwm2023/and05-funbox/assets/11827454/cc33c9d3-1953-40a8-ae93-be604018ec0f" width="200">

### 네이버 지도상 실시간 위치 공유
* 폴링으로 유저들의 실시간 위치를 공유해요
<img src="https://github.com/boostcampwm2023/and05-funbox/assets/11827454/bffe0656-2107-4f50-bf7d-8f5e84a02de7" width="200">

### 채팅과 미니 게임 (TMI 퀴즈)
* Socket.io로 채팅과 미니 게임을 구현했어요 

<img src="https://github.com/boostcampwm2023/and05-funbox/assets/11827454/0d95f3d8-cb0d-45bb-9cd3-eae76eb093a9" width="200">
<img src="https://github.com/boostcampwm2023/and05-funbox/assets/11827454/5e173e39-6ea8-4b98-9c5f-b7fbbbeb70db" width="200">
<img src="https://github.com/boostcampwm2023/and05-funbox/assets/11827454/0f5020d1-572a-493f-a694-879cbc8c0be6" width="200">

## ⚒ 기술스택

### Android
| Category  | TechStack |
| ------------- | ------------- |
| Architecture  | [MVVM](https://www.notion.so/standingtiger/Android-MVVM-17b0401697b440abbfce093c37ce2664) | 
| Network | [Retrofit](https://www.notion.so/standingtiger/Android-Retrofit2-with-moshi-424c2a23ba67468c983c0ed50deec952), [OkHttp](https://www.notion.so/standingtiger/Android-Retrofit2-with-moshi-424c2a23ba67468c983c0ed50deec952), [Moshi](https://www.notion.so/standingtiger/Android-Retrofit2-with-moshi-424c2a23ba67468c983c0ed50deec952), socket.io | 
| Asynchronous | [Coroutines](https://www.notion.so/standingtiger/Android-Coroutines-188727db63d24c9582817f4958156fb0), [Flow](https://www.notion.so/standingtiger/Android-SharedFlow-vs-StateFlow-d21f3d6ac52d4d729952dd63858ea267) | 
| Jetpack | DataBinding, Navigation, Fragment, Lifecycle, Material Design Components | 
| Image | [Coil](https://www.notion.so/standingtiger/Android-Coil-38933ade945444fe91e968fb1e5f839d), Glide | 
| Map | [Naver Map](https://www.notion.so/standingtiger/Android-NAVER-4fc0840f69fd4018b909874982285eaf) | 
| Login | [OAuth](https://www.notion.so/standingtiger/Android-NAVER-3eca4c9d3dcc4691bd794af1649efb1c) | 
| CI/CD | [Firebase App Distribution](https://www.notion.so/standingtiger/Android-Firebase-App-Distribution-d4cedd3dc6de4af2a2807f49214306f7) | 
| Test | Junit | 
| Logging | [Timber](https://www.notion.so/standingtiger/Timber-eea2750e4aba4f5e8a811aa0b45fccf5) | 

### Backend
| Category  | TechStack |
| ------------- | ------------- |
| Framework, Language | NestJS, TypeScript  |
| DB | MySQL  |
| ORM | TypeORM  |
| API Docs | Swagger |
| CI/CD | Github Actions  |
| NCP | Server, VPC, Object Storage|

## 👥 Team RPG (Rhythm, Power, Gypjoongryuk!)

### 팀 구성
<div align="center">

|김선범(BE)|김승찬(BE)|김시환(AOS)|김신영(AOS)|정지원(AOS)|
|:--:|:--:|:--:|:--:|:--:|
|<a href="https://github.com/k33ps/"> <img src="https://avatars.githubusercontent.com/u/11827454?v=4" width="100px" height="100px"> </a>|<a href="https://github.com/sschan99"> <img src="https://avatars.githubusercontent.com/u/42964952?v=4" width="100px" height="100px"> </a>|<a href="https://github.com/van1164"> <img src="https://avatars.githubusercontent.com/u/52437971?v=4" width="100px" height="100px"> </a>|<a href="https://github.com/tlsdud135"> <img src="https://avatars.githubusercontent.com/u/62438036?v=4" width="100px" height="100px"> </a>|<a href="https://github.com/littlesam95"> <img src="https://avatars.githubusercontent.com/u/55424662?v=4" width="100px" height="100px"> </a>|
|"이때까지 배운것들의 복습. 기본기에 충실하자!"|"기본적인 아키텍처나 디자인 패턴 등을 완성도있게 활용할 생각입니다."|"이력서 포트폴리오에 쓸 수있는 최종 배포까지 가는 프로젝트"|"끝까지 했으면 좋겠습니다"|"멤버십에서 8주간 학습한 것을 활용해보고 싶습니다."|
</div>

### 기술적 도전과 고민

#### Backend
1. ...

#### Android
1. 퀴즈 게임 로직 구현
 - 퀴즈 게임 기능을 구현하기 위하여 BE와 협업하여 소켓 프로그래밍을 바탕으로 한 퀴즈 게임 로직을 구현하였습니다.
 - 구현하는 과정에서 2가지의 문제와 마주치게 되어, 해결 방법을 고민하고 선택했습니다.
   - 첫 번째로, **소켓 이벤트 통신이 제대로 발생하지 않는 현상이 발생**하였습니다.
     - 예를 들어 게임 신청 후 상대방은 신청을 수락한 후 게임 화면으로 바로 이동하는데, 정작 게임 신청을 한 유저는 대기 화면에서 게임 화면으로 넘어가지 않는 등, 이벤트를 수신하지 못 하는 현상이 발생하였습니다.
     - 각 화면별로 소켓을 새로 연결하고 있어 소켓 통신이 원활하게 동작하지 않는다고 판단하였고, **싱글톤 패턴을 적용하여 하나의 소켓 객체를 만들고 여러 화면이 그 소켓 객체만을 활용하도록** 하였습니다.
   - 두 번째로, 게임 신청을 하는 사람은 대기 화면에서 대기하고 있다가 상대방이 신청을 수락하는 경우 게임 시작 이벤트가 발생하고, 클라이언트가 해당 이벤트를 수신한 경우 게임 화면으로 이동하는데, **게임 시작이 되었다는 이벤트를 수신하지 못 해 대기 화면에서 계속 대기하는 현상이 발생**하였습니다.
     - 회의끝에 Fragment의 lifecycle을 고려하였을 때, 게임 화면이 Activity에 onAttach되기 전에 **이미 게임 시작 이벤트를 구독한 상태로 로직을 변경한다면 해당 문제를 해결할 수 있겠다**는 결론을 내렸습니다.
     - 저희는 대기 화면과 게임 화면을 같은 Activity가 관리하며, 같은 ViewModel을 참조하도록 구현하였기 때문에 화면에서 이벤트를 구독하는 것이 아닌, **ViewModel에서 이벤트를 구독**할 수 있게 하였고, 그 결과 **Activity의 onCreate 단계에서 게임에 필요한 모든 이벤트를 구독하여 게임 시작 이벤트를 수신**하여 게임 화면이 출력되도록 할 수 있었습니다.

2. Naver Map의 InfoWindow가 깜빡이는 문제
 - 사용자의 위치를 나타내는 마커를 터치하면 출력되는 InfoWindow 관련된 처리를 하는 것이 큰 기술적 도전이었습니다.
   - 먼저 마커 UI를 구현함에 있어서, **마커를 터치하면 나타나는 InfoWindow에 해당 유저의 닉네임, 프로필 사진, 상태 메시지가 나타나야 하는데, 깜빡이면서 업데이트 되는 현상**이었습니다.
   - 또한, **InfoWindow가 존재하는 상태에서 해당 유저가 움직이는 경우, InfoWindow도 마커를 따라 움직여야 하지만, 그러지 않는 문제가 발생**하였습니다.
     - 저희는 이러한 문제를 해결하기 위해 **HashMap을 활용**하였는데요. 먼저 **처음 지도에 들어 왔을때 조건에 맞는 유저들의 정보를 StateFlow 형태의 HashMap에 저장**합니다.
     - 그 후 일정 시간마다 주변 사용자 리스트를 서버에서 받아왔을 때, **이미 HashMap에 있는 유저는  위치 정보와 수정 사항만 갱신하면서 InfoWindow를 동일하게 띄워주고 이동이 자연스럽게 동작**하도록 작업하였습니다.

3. 채팅 내용이 바로 반영되지 않는 문제
 - 게임 화면의 채팅 기능에서의 문제였습니다. StateFlow를 다루는 과정에서 생긴 문제인데요. 채팅의 경우 채팅 내용을 flow를 이용하여 내용을 채팅 내역들을 저장하고 보여주는 형식으로 작성하였습니다.
 - 이 때 리스트로된 stateFlow는 리스트값이 추가되는 것으로는 collect가 작동하지 않아 **채팅이 제대로 갱신되지 않는 문제**가 있었습니다.
   - **채팅 전송 상태에 따른 stateflow를 따로 두어서 채팅이 추가 될 때 viewModel 내부에서 업데이트 후 채팅 전송 상태를 collect하여 갱신**시키도록 변경하였습니다.

4. 권한과 버전별 대응
 - 권한 및 버전별 대응과 관련되어 어떤 처리를 해줄지를 고민하였습니다.
 - 저희 FunBox를 사용하기 위해서는 3가지 권한이 필요한데요, 먼저 안드로이드 버전 13 미만이라면 프로필 사진을 설정하기 위하여 갤러리 등 로컬 저장 공간에 접근하도록 되어 있어, 이 과정에서 **저장 공간 및 카메라 관련 권한이 필요**합니다.
또한 위치 기반 서비스인 만큼, 사용자의 현재 위치를 서버에 지속적으로 전송하고 있고 이 과정에서 **위치 관련 권한이 필수적**입니다.
   - 하지만 사용자가 권한을 허용하고 싶지 않아할 경우에는 **권한 허용이 필요하다는 토스트 메시지를 띄우도록** 하였습니다.
   - 다만, 안드로이드 버전이 13 이상이거나, 안드로이드 12의 상위 버전인 경우에는 PhotoPicker를 사용하여 이미지 파일을 가져올 수 있도록 하였고, 여기에는 저장 공간과 관련된 권한이 필요가 없어 권한 허용에 대해 따로 사용자에게 묻지 않도록 함으로써 버전 별로 대응 또한 하고자 하였습니다.

### 링크
<a href="https://www.notion.so/standingtiger/FunBox-17ef334b88974d09b356c4833cc37806">
  <img alt="Static Badge" src="https://img.shields.io/badge/Notion-%2523000000.svg?style=for-the-badge&logo=notion&logoColor=white&labelColor=black&color=black&link=https%3A%2F%2Fwww.notion.so%2Fstandingtiger%2FFunBox-17ef334b88974d09b356c4833cc37806">
</a>
<a href="https://github.com/boostcampwm2023/and05-funbox/wiki">
  <img alt="Static Badge" src="https://img.shields.io/badge/github%20wiki-%252523121011.svg?style=for-the-badge&logo=github&logoColor=white&labelColor=black&color=black&link=https%3A%2F%2Fgithub.com%2Fboostcampwm2023%2Fand05-funbox%2Fwiki">
</a>
